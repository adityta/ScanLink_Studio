<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Full Favicon Pack -->
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="icon" type="image/x-icon" href="/favicon.ico">
<link rel="icon" type="image/png" sizes="192x192" href="/android-chrome-192x192.png">
<link rel="icon" type="image/png" sizes="512x512" href="/android-chrome-512x512.png">

  <script src="seo-auto.js"></script>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>QR Scanner Pro</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jsQR/1.4.0/jsQR.min.js"></script>
<style>
  body{font-family:Poppins,system-ui;background:#f4f7fb;margin:0;padding:20px}
  .wrap{max-width:820px;margin:12px auto;background:#fff;padding:18px;border-radius:12px;box-shadow:0 10px 30px rgba(2,6,23,0.06)}
  h1{margin:0 0 8px;color:#0f47d3}
  .controls{display:flex;gap:8px;flex-wrap:wrap}
  button,input{padding:10px 12px;border-radius:10px;border:0;cursor:pointer}
  .btn-primary{background:#0f47d3;color:#fff}
  .btn-ghost{background:#fff;border:1px solid #e6e9ef}
  video{width:100%;border-radius:10px;margin-top:12px}
  canvas{display:none}
  #result{display:none;margin-top:12px;padding:12px;background:#eaf0ff;border-left:4px solid #0f47d3;border-radius:8px}
  .actions{display:flex;gap:8px;margin-top:10px}
  .actions button{flex:1}
</style>
</head>
<body>
<div class="wrap">
  <h1>QR Scanner Pro</h1>
  <div class="controls">
    <button id="startBtn" class="btn-primary">Start Camera</button>
    <button id="stopBtn" class="btn-ghost" style="display:none">Stop Camera</button>
    <label class="btn-ghost" style="cursor:pointer">
      <input id="file" type="file" accept="image/*" style="display:none"> Upload Image
    </label>
  </div>

  <div style="position:relative;margin-top:12px">
    <video id="video" playsinline></video>
  </div>

  <canvas id="canvas"></canvas>

  <div id="result"><strong>Result:</strong><div id="resultText"></div></div>

  <div class="actions">
    <button id="copyBtn" class="btn-primary" style="display:none">Copy</button>
    <button id="openBtn" class="btn-ghost" style="display:none">Open Link</button>
    <button id="saveBtn" class="btn-ghost" style="display:none">Download TXT</button>
  </div>
</div>

<script>
const startBtn = document.getElementById('startBtn');
const stopBtn = document.getElementById('stopBtn');
const fileInput = document.getElementById('file');
const video = document.getElementById('video');
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const result = document.getElementById('result');
const resultText = document.getElementById('resultText');
const copyBtn = document.getElementById('copyBtn');
const openBtn = document.getElementById('openBtn');
const saveBtn = document.getElementById('saveBtn');

let stream = null;
let last = '';

async function startCamera(){
  try{
    stream = await navigator.mediaDevices.getUserMedia({video:{facingMode:'environment'}});
    video.srcObject = stream;
    await video.play();
    startBtn.style.display='none';
    stopBtn.style.display='inline-block';
    requestAnimationFrame(tick);
  }catch(e){
    alert('Camera access denied or not available.');
  }
}

function stopCamera(){
  if(stream){ stream.getTracks().forEach(t=>t.stop()); stream=null; }
  video.pause(); video.srcObject = null;
  startBtn.style.display='inline-block';
  stopBtn.style.display='none';
}

function tick(){
  if(!video || video.readyState !== video.HAVE_ENOUGH_DATA) {
    requestAnimationFrame(tick); return;
  }
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  ctx.drawImage(video,0,0,canvas.width,canvas.height);
  const img = ctx.getImageData(0,0,canvas.width,canvas.height);
  const code = jsQR(img.data, img.width, img.height, {inversionAttempts:'attemptBoth'});
  if(code){
    handleResult(code.data);
  } else {
    requestAnimationFrame(tick);
  }
}

function handleResult(text){
  last = text;
  result.style.display='block';
  resultText.textContent = text;
  copyBtn.style.display='inline-block';
  saveBtn.style.display='inline-block';
  if(text.startsWith('http')) openBtn.style.display='inline-block';
  else openBtn.style.display='none';
  // beep & vibrate
  if(typeof navigator.vibrate === 'function') navigator.vibrate(150);
  try{ new Audio('https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg').play(); }catch(e){}
}

startBtn.addEventListener('click', startCamera);
stopBtn.addEventListener('click', ()=>{ stopCamera(); });

fileInput.addEventListener('change', ()=>{
  const f = fileInput.files[0];
  if(!f) return;
  const img = new Image();
  img.onload = ()=>{
    canvas.width = img.naturalWidth;
    canvas.height = img.naturalHeight;
    ctx.drawImage(img,0,0);
    const data = ctx.getImageData(0,0,canvas.width,canvas.height);
    const code = jsQR(data.data, data.width, data.height, {inversionAttempts:'attemptBoth'});
    if(code) handleResult(code.data);
    else { result.style.display='block'; resultText.textContent = 'No QR found in image.'; copyBtn.style.display='none'; saveBtn.style.display='none'; openBtn.style.display='none'; }
  };
  img.src = URL.createObjectURL(f);
});

copyBtn.addEventListener('click', ()=>{ navigator.clipboard.writeText(last); copyBtn.textContent='Copied âœ“'; setTimeout(()=>copyBtn.textContent='Copy',1000); });
openBtn.addEventListener('click', ()=>{ if(last.startsWith('http')) window.open(last,'_blank'); });
saveBtn.addEventListener('click', ()=>{
  const a = document.createElement('a');
  a.href = URL.createObjectURL(new Blob([last],{type:'text/plain'}));
  a.download = 'qr-result.txt';
  a.click();
});
</script>
</body>
</html>

